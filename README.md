# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка
```
npm run build
```

или

```
yarn build
```
## Архитектура проекта
Проект выполнен по MVP паттерну

## Описание данных
```
// Информация о продукте
interface IProductItem {
  id: string; // Идентификатор
  description: string; // Описание
  image: string; // Эндпоинт картинки
  title: string; // Название
  category: string; // Категория
  price: number | null // Цена
}

// Приложение
interface IAppState {
  catalog: IProductItem[]; // Каталог товаров
  cart: string[]; // Корзина
}

type ICartItem = Pick<IProductItem, 'id' | 'title' | 'price'> // Товар в корзине
type PaymentMethod = 'online' | 'received'; // Способ оплаты

// Форма оплаты
interface IOrderForm {
  method: PaymentMethod; // Способ оплаты
  adress: string; // Адрес
  email: string; // Email
  phone: string; // Телефон
}

// Заказ
interface IOrder extends IOrderForm {
  items: string[] // Товары в заказе
}

// Сформированный заказ
interface IOrderResult {
  id: string; // Идентификатор заказа
  total: number; // Сумма заказа
}
```

## Базовый код
### 1. Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы ```on```, ```off```, ```emit``` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.

### 2. Класс Component
Базовый компонент предоставляющий инструменты для работы с DOM дочерних классов.
Класс имеет методы: 

```setText``` - Устанавливает текстовое содержимое.  
```setImage``` - Устанавливает изображение с альтернативным текстом.  
```setHidden``` - Скрыть элемент.  
```setVisible``` - Показать элемент.  
```render``` - Возвращает корневой элемент.  

## Компоненты модели данных
### 1. Класс AppData
Управляет приложением. Реализует тип IAppState.

Класс имеет методы:  
```setCatalog``` - Получает каталог и сохраняет его.  
```getCatalog``` - Возвращает каталог.  
```addToCart``` - Добавляет товар в корзину.  
```deleteFromCart``` - Удаляет товар из корзины.  
```clearCart``` - Очищает корзину.  
```getTotal``` - Возвращает стоимость всех товаров в корзине.  
```getProductList``` - Получает список товаров в корзине.
```setOrderField``` - Получает и сохраняет данные формы.
```validateOrder``` - Валидирует данные формы.

### 2. Класс ShopApi
Позволяет взаимодействовать с сервером.

Класс имеет методы:  
```getProductList``` - Получает список товаров с сервера.  
```getProduct``` - Получает товар с сервера.  
```orderProducts``` - Передает заказ серверу.  

## Компоненты представления
### 1. Класс Modal
Отображает модальное окно.
Реализует модальное окно в котором может отображаться какое либо содержимое ```(content: HTMLElement)```. 
Так же предоставляет методы ```open``` и ```close``` для управления отображением модального окна.

### 2. Класс Card
Отображает карточку товара.

```
// Данные карточки
interface ICard {
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null
}
```

Карточка формируется на основании получаемого темплейта и отвечает за взаимодействие пользователя с карточкой генерируя событие ```cardModal:open``` при клике на ней (для каталога товаров на главной) или обрабатывает клик на кнопке внутри карточки товара (для корзины и модального окна описания товара).

### 3. Класс Cart
Отображает корзину.

```
interface ICartView {
    items: HTMLElement[]; // Список товаров в корзине
    total: number; // Общая стоимость товаров в корзине
}
```

Корзина формируется на основании получаемого темплейта и отвечает за взаимодействие пользователя с корзиной генерируя событие ```cartModal:open``` при клике на иконку корзины.

### 4. Класс Form
Отображает форму оформления заказа.

```
interface IFormState {
    valid: boolean; // Валидность формы
    errors: string[]; // Ошибки формы
}
```

Форма формируется на основании получаемого темплейта и отвечает за взаимодействие пользователя с формой генерируя событие ```formStep1:open``` при клике на кнопку "Оформить".
При переходе на второй шаг формы (по кнопке "Далее") генерируется событие ```formStep2:open```.  
При клике по кнопке "Оплатить" генерируется событие ```form:pending```
Так же предоставляет метод ```clearData``` для очистки формы.

### 5. Класс Succsess
Отображает подтверждение заказа.

```
interface ISuccess {
    total: number; // Сумма товаров в оформленном заказе.
}
```

Подтверждение заказа формируется основании получаемого темплейта и отвечает за взаимодействие пользователя с корзиной генерируя событие ```newShopping:start```.

### 6. Класс Page
Отображает главную страницу.

```
interface IPage {
    catalog: HTMLElement[]; // Список товаров в каталоге.
}
```

## Взаимодействие между компонентами
Класс ```ShopApi``` получает данные с сервера. После класс ```AppData``` собирает из полученных данных массив карточек отправляет его на отрисовку в класс ```Page```, карточка каждого товара формируется в классе ```Card```. Все модальные окна отрисовываются с помощью класса ```Modal```. При клике на кнопку "Купить" по событию ```card:select``` определяется какая карточка была выбрана и показывается её модальное окно. При клике на кнопку "В корзину", с помощью метода класса ```AppData```, товар добавляется в корзину. При клике на иконку корзины с помощью класса ```Cart``` происходит отображение модального окна корзины, данные о корзине получаются из класса ```AppData```. При клике кнопки "Оформить" показывается модальное окно формы с помощью класса ```Form```. Данные из формы отправляются в класс ```AppData```, где проходят валидацию, при успешной валидации данных формы с помощью класса ```ShopApi```, заказ отправляется на сервер, если же данные формы не проходят валидацию, то появляется сообщение об ошибке. При положительном ответе от сервера происходит событие ```formSuccsess:open``` с помощью класса ```Succsess``` отображается подтверждение заказа и происходит очистка формы с помощью метода класса ```Form```. При отрицательном ответе от сервера происходит событие ```formSuccsess:error```, выводится ошибка.

Все взаимодействия между слоями данных и отображения происходят в файле index.ts, находящийся в корне проекта.